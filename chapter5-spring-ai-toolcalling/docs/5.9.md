# 5.9 å³æ™‚è³‡æ–™æŸ¥è©¢ - ä¸²æ¥æ°£è±¡ API

> **å°æ‡‰ç¯„ä¾‹**: `chapter5-spring-ai-advanced`
> **é›£åº¦**: â­â­â­â˜†â˜†

---

## ğŸ“š æœ¬ç« æ¦‚è¦

å­¸ç¿’å¦‚ä½•æ•´åˆçœŸå¯¦çš„ç¬¬ä¸‰æ–¹ APIï¼Œè®“ AI èƒ½å¤ ç²å–å³æ™‚è³‡è¨Šã€‚é€éä¸­å¤®æ°£è±¡å±€ API ç¯„ä¾‹ï¼Œä½ å°‡æŒæ¡å¾ API è¨»å†Šã€è³‡æ–™è§£æåˆ°å·¥å…·æ•´åˆçš„å®Œæ•´æµç¨‹ã€‚

**å­¸ç¿’ç›®æ¨™**:
- æ•´åˆçœŸå¯¦çš„ç¬¬ä¸‰æ–¹ APIï¼ˆä¸­å¤®æ°£è±¡å±€ï¼‰
- æŒæ¡ JSON è³‡æ–™è§£ææŠ€è¡“
- å»ºç«‹å¤©æ°£æŸ¥è©¢å·¥å…·ç³»çµ±
- è™•ç† API éŒ¯èª¤å’Œç•°å¸¸æƒ…æ³

---

## ğŸ¯ ç‚ºä»€éº¼è¦æ•´åˆçœŸå¯¦ API?

### æ¨¡æ“¬è³‡æ–™çš„å•é¡Œ

ç¶²è·¯ä¸Šè¨±å¤šæ•™å­¸ä½¿ç”¨æ¨¡æ“¬è³‡æ–™ï¼š

```java
// âŒ æ¨¡æ“¬è³‡æ–™åšæ³•
@Tool(description = "Get weather information")
public String getWeather(String city) {
    // è¿”å›å›ºå®šçš„å‡è³‡æ–™
    return "å°åŒ—ä»Šå¤©æ™´å¤©ï¼Œæº«åº¦ 25Â°C";
}
```

**å•é¡Œ**:
- ğŸ“… è³‡æ–™æ°¸é ä¸è®Šï¼Œç„¡æ³•åæ˜ çœŸå¯¦æƒ…æ³
- ğŸ“ åƒ…ä¾›å­¸ç¿’ï¼Œç„¡æ³•å¯¦éš›æ‡‰ç”¨
- âŒ ç„¡æ³•é«”é©—çœŸå¯¦çš„ API æ•´åˆæŒ‘æˆ°

### çœŸå¯¦ API çš„åƒ¹å€¼

```java
// âœ… çœŸå¯¦ API åšæ³•
@Tool(description = "Get current weather information from CWA")
public WeatherInfo getCurrentWeather(String location) {
    // èª¿ç”¨ä¸­å¤®æ°£è±¡å±€ API
    String url = baseUrl + "/O-A0003-001?Authorization=" + apiKey;
    JsonNode response = restTemplate.getForObject(url, JsonNode.class);

    // è§£æçœŸå¯¦è³‡æ–™
    return parseWeatherData(response, location);
}
```

**å„ªå‹¢**:
- âœ… å³æ™‚æ›´æ–°çš„çœŸå¯¦è³‡æ–™
- âœ… å¯å¯¦éš›æ‡‰ç”¨æ–¼ç”¢å“
- âœ… å­¸ç¿’å®Œæ•´çš„æ•´åˆæµç¨‹
- âœ… è™•ç†çœŸå¯¦ä¸–ç•Œçš„æŒ‘æˆ°

---

## ğŸŒ¤ï¸ ä¸­å¤®æ°£è±¡å±€ API æ•´åˆ

### 1. è¨»å†Šå’Œå–å¾— API Key

**æ­¥é©Ÿæµç¨‹**:

```mermaid
graph LR
    A[1. è¨ªå• CWA é–‹æ”¾å¹³å°] --> B[2. è¨»å†Šå¸³è™Ÿ]
    B --> C[3. ç™»å…¥ç³»çµ±]
    C --> D[4. å–å¾—æˆæ¬Šç¢¼]
    D --> E[5. æ¸¬è©¦ API]

    style A fill:#e1f5ff
    style D fill:#fff4e6
    style E fill:#e8f5e9
```

**è©³ç´°èªªæ˜**:

1. **è¨ªå•é–‹æ”¾å¹³å°**: [https://opendata.cwa.gov.tw/index](https://opendata.cwa.gov.tw/index)
2. **è¨»å†Šå¸³è™Ÿ**: å®Œæˆæœƒå“¡è¨»å†Š
3. **å–å¾—æˆæ¬Šç¢¼**: æœƒå“¡è³‡è¨Š â†’ å–å¾—æˆæ¬Šç¢¼
4. **é¸æ“‡è³‡æ–™é›†**: è³‡æ–™ä¸»é¡Œ â†’ è§€æ¸¬ â†’ ç¾åœ¨å¤©æ°£è§€æ¸¬å ±å‘Š
5. **æ¸¬è©¦ API**: ä½¿ç”¨ Swagger ä»‹é¢æ¸¬è©¦

### 2. API è³‡æ–™çµæ§‹

ä¸­å¤®æ°£è±¡å±€ API å›å‚³çš„ JSON çµæ§‹ï¼š

```json
{
  "records": {
    "location": [
      {
        "locationName": "æ¡ƒåœ’",
        "weatherElement": [
          {
            "elementName": "TEMP",
            "elementValue": "28.5"
          },
          {
            "elementName": "HUMD",
            "elementValue": "72"
          },
          {
            "elementName": "Weather",
            "elementValue": "å¤šé›²"
          }
        ]
      }
    ]
  }
}
```

### 3. è³‡æ–™è§£ææµç¨‹

```mermaid
sequenceDiagram
    participant S as Spring AI
    participant W as WeatherService
    participant API as CWA API
    participant P as è³‡æ–™è§£æå™¨

    S->>W: getCurrentWeather("æ¡ƒåœ’")
    W->>API: GET /O-A0003-001
    API-->>W: JSON è³‡æ–™
    W->>P: parseWeatherData(json)
    P->>P: æå– location
    P->>P: æå– weatherElement
    P->>P: è§£ææº«åº¦ã€æ¿•åº¦ç­‰
    P-->>W: WeatherInfo ç‰©ä»¶
    W-->>S: çµæ§‹åŒ–å¤©æ°£è³‡è¨Š
```

---

## ğŸ’» å¯¦æˆ°ï¼šå»ºç«‹å¤©æ°£æŸ¥è©¢ç³»çµ±

### 1. å°ˆæ¡ˆé…ç½®

**Maven ä¾è³´**:

```xml
<dependencies>
    <!-- Spring AI OpenAI Starter -->
    <dependency>
        <groupId>org.springframework.ai</groupId>
        <artifactId>spring-ai-openai-spring-boot-starter</artifactId>
    </dependency>

    <!-- Spring Boot Web -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
</dependencies>
```

**æ‡‰ç”¨ç¨‹å¼é…ç½®**:

```yaml
# application.yml

spring:
  ai:
    openai:
      api-key: ${OPENAI_API_KEY}
      chat:
        options:
          model: gpt-4o-mini
          temperature: 0.1

# ä¸­å¤®æ°£è±¡å±€ API é…ç½®
cwa:
  api:
    key: ${CWA_API_KEY}  # ä½ çš„ API Key
    base-url: https://opendata.cwa.gov.tw/api/v1/rest/datastore

logging:
  level:
    com.example.weather: DEBUG
```

### 2. å¤©æ°£æœå‹™å¯¦ç¾

ç°¡åŒ–çš„å¤©æ°£æŸ¥è©¢æœå‹™ï¼š

```java
// å°æ‡‰ç¯„ä¾‹: chapter5-spring-ai-advanced/.../service/WeatherService.java:150

@Service
@RequiredArgsConstructor
@Slf4j
public class WeatherService {

    private final RestTemplate restTemplate;

    @Value("${cwa.api.key}")
    private String apiKey;

    @Value("${cwa.api.base-url}")
    private String baseUrl;

    /**
     * å–å¾—æŒ‡å®šåœ°å€çš„ç›®å‰å¤©æ°£è³‡è¨Š
     */
    @Tool(description = "Get current weather information for a specific location in Taiwan. " +
          "Supports major cities and counties like Taipei, Taoyuan, Taichung, Tainan, Kaohsiung, etc.")
    public WeatherInfo getCurrentWeather(String location) {
        try {
            log.info("æŸ¥è©¢å¤©æ°£è³‡è¨Šï¼š{}", location);

            // èª¿ç”¨ä¸­å¤®æ°£è±¡å±€ API
            String url = baseUrl + "/O-A0003-001?Authorization=" + apiKey;
            JsonNode response = restTemplate.getForObject(url, JsonNode.class);

            if (response == null || !response.has("records")) {
                return WeatherInfo.error("ç„¡æ³•å–å¾—å¤©æ°£è³‡æ–™");
            }

            // è§£æå¤©æ°£è³‡æ–™
            JsonNode records = response.get("records");
            JsonNode locations = records.get("location");

            // å°‹æ‰¾æŒ‡å®šåœ°å€çš„å¤©æ°£è³‡æ–™
            for (JsonNode locationNode : locations) {
                String locationName = locationNode.get("locationName").asText();

                if (locationName.contains(location) || location.contains(locationName)) {
                    WeatherInfo result = parseWeatherData(locationNode, locationName);
                    log.info("æˆåŠŸå–å¾— {} çš„å¤©æ°£è³‡è¨Š", locationName);
                    return result;
                }
            }

            return WeatherInfo.notFound("æ‰¾ä¸åˆ° " + location + " çš„å¤©æ°£è³‡æ–™");

        } catch (Exception e) {
            log.error("å–å¾—å¤©æ°£è³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤: {}", e.getMessage(), e);
            return WeatherInfo.error("å–å¾—å¤©æ°£è³‡æ–™å¤±æ•—ï¼š" + e.getMessage());
        }
    }

    /**
     * å–å¾—å…¨å°å„åœ°çš„æº«åº¦æ’è¡Œæ¦œ
     */
    @Tool(description = "Get temperature ranking for all locations in Taiwan. " +
          "Returns top N locations sorted by temperature.")
    public TemperatureRanking getTemperatureRanking(Integer topCount) {
        if (topCount == null || topCount <= 0) {
            topCount = 10;
        }

        try {
            log.info("æŸ¥è©¢æº«åº¦æ’è¡Œæ¦œï¼šå‰ {} å", topCount);

            String url = baseUrl + "/O-A0003-001?Authorization=" + apiKey;
            JsonNode response = restTemplate.getForObject(url, JsonNode.class);

            if (response == null || !response.has("records")) {
                return TemperatureRanking.error("ç„¡æ³•å–å¾—å¤©æ°£è³‡æ–™");
            }

            List<LocationTemperature> temperatures = new ArrayList<>();
            JsonNode locations = response.get("records").get("location");

            // æ”¶é›†æ‰€æœ‰åœ°é»çš„æº«åº¦
            for (JsonNode locationNode : locations) {
                String locationName = locationNode.get("locationName").asText();
                JsonNode weatherElements = locationNode.get("weatherElement");

                Double temp = extractTemperature(weatherElements);
                if (temp != null) {
                    temperatures.add(new LocationTemperature(locationName, temp));
                }
            }

            // æŒ‰æº«åº¦æ’åºä¸¦å–å‰ N å
            List<LocationTemperature> topTemperatures = temperatures.stream()
                    .sorted((a, b) -> Double.compare(b.temperature(), a.temperature()))
                    .limit(topCount)
                    .toList();

            log.info("æˆåŠŸå–å¾—æº«åº¦æ’è¡Œæ¦œï¼š{} å€‹åœ°é»", topTemperatures.size());

            return new TemperatureRanking(
                    topTemperatures,
                    true,
                    null,
                    LocalDateTime.now().format(DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss"))
            );

        } catch (Exception e) {
            log.error("å–å¾—æº«åº¦æ’è¡Œæ™‚ç™¼ç”ŸéŒ¯èª¤: {}", e.getMessage(), e);
            return TemperatureRanking.error("å–å¾—æº«åº¦æ’è¡Œå¤±æ•—ï¼š" + e.getMessage());
        }
    }

    /**
     * è§£æå¤©æ°£è³‡æ–™
     */
    private WeatherInfo parseWeatherData(JsonNode locationNode, String locationName) {
        JsonNode weatherElements = locationNode.get("weatherElement");

        Double temperature = extractTemperature(weatherElements);
        Double humidity = extractHumidity(weatherElements);
        String weather = extractWeatherDescription(weatherElements);
        Double rainfall = extractRainfall(weatherElements);
        String windDirection = extractWindDirection(weatherElements);
        Double windSpeed = extractWindSpeed(weatherElements);

        return new WeatherInfo(
                locationName,
                temperature,
                humidity,
                weather,
                rainfall,
                windDirection,
                windSpeed,
                true,
                null,
                LocalDateTime.now().format(DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss"))
        );
    }

    // è¼”åŠ©æ–¹æ³•ï¼šæå–å„ç¨®æ°£è±¡è³‡æ–™
    private Double extractTemperature(JsonNode weatherElements) {
        return extractElementValue(weatherElements, "TEMP");
    }

    private Double extractHumidity(JsonNode weatherElements) {
        return extractElementValue(weatherElements, "HUMD");
    }

    private Double extractRainfall(JsonNode weatherElements) {
        return extractElementValue(weatherElements, "24R");
    }

    private Double extractWindSpeed(JsonNode weatherElements) {
        return extractElementValue(weatherElements, "WDSD");
    }

    private String extractWeatherDescription(JsonNode weatherElements) {
        JsonNode element = findWeatherElement(weatherElements, "Weather");
        if (element != null && element.has("elementValue")) {
            return element.get("elementValue").asText();
        }
        return null;
    }

    private String extractWindDirection(JsonNode weatherElements) {
        JsonNode element = findWeatherElement(weatherElements, "WDIR");
        if (element != null && element.has("elementValue")) {
            return element.get("elementValue").asText();
        }
        return null;
    }

    private Double extractElementValue(JsonNode weatherElements, String elementName) {
        JsonNode element = findWeatherElement(weatherElements, elementName);
        if (element != null && element.has("elementValue")) {
            try {
                return element.get("elementValue").asDouble();
            } catch (Exception e) {
                log.warn("ç„¡æ³•è§£æ {} çš„æ•¸å€¼", elementName);
            }
        }
        return null;
    }

    private JsonNode findWeatherElement(JsonNode weatherElements, String elementName) {
        if (weatherElements != null && weatherElements.isArray()) {
            for (JsonNode element : weatherElements) {
                if (element.has("elementName") &&
                    elementName.equals(element.get("elementName").asText())) {
                    return element;
                }
            }
        }
        return null;
    }
}
```

### 3. è³‡æ–™æ¨¡å‹å®šç¾©

```java
// å°æ‡‰ç¯„ä¾‹: chapter5-spring-ai-advanced/.../model/WeatherInfo.java

/**
 * å¤©æ°£è³‡è¨Šè³‡æ–™é¡åˆ¥
 */
public record WeatherInfo(
        @JsonProperty("location") String location,
        @JsonProperty("temperature") Double temperature,
        @JsonProperty("humidity") Double humidity,
        @JsonProperty("weather") String weather,
        @JsonProperty("rainfall") Double rainfall,
        @JsonProperty("wind_direction") String windDirection,
        @JsonProperty("wind_speed") Double windSpeed,
        @JsonProperty("success") boolean success,
        @JsonProperty("error") String error,
        @JsonProperty("observation_time") String observationTime
) {
    public static WeatherInfo error(String message) {
        return new WeatherInfo(null, null, null, null, null, null, null,
                false, message, null);
    }

    public static WeatherInfo notFound(String message) {
        return new WeatherInfo(null, null, null, null, null, null, null,
                false, message, null);
    }
}

/**
 * æº«åº¦æ’è¡Œè³‡æ–™
 */
public record TemperatureRanking(
        List<LocationTemperature> rankings,
        boolean success,
        String error,
        String updateTime
) {
    public static TemperatureRanking error(String message) {
        return new TemperatureRanking(List.of(), false, message, null);
    }
}

public record LocationTemperature(
        String location,
        Double temperature
) {}
```

---

## ğŸ® æ§åˆ¶å™¨å¯¦ç¾

```java
// å°æ‡‰ç¯„ä¾‹: chapter5-spring-ai-advanced/.../controller/WeatherController.java:486

@RestController
@RequestMapping("/api/weather")
@RequiredArgsConstructor
@Slf4j
public class WeatherController {

    private final ChatClient chatClient;
    private final WeatherService weatherService;

    /**
     * AI å¤©æ°£æŸ¥è©¢
     */
    @GetMapping("/chat")
    public ResponseEntity<WeatherChatResponse> chatWeather(@RequestParam String question) {
        try {
            log.info("æ”¶åˆ°å¤©æ°£æŸ¥è©¢ï¼š{}", question);

            String response = chatClient
                    .prompt(question)
                    .tools(weatherService)
                    .call()
                    .content();

            WeatherChatResponse chatResponse = new WeatherChatResponse(
                    question,
                    response,
                    true,
                    null,
                    System.currentTimeMillis()
            );

            return ResponseEntity.ok(chatResponse);

        } catch (Exception e) {
            log.error("å¤©æ°£æŸ¥è©¢å¤±æ•—: {}", e.getMessage(), e);

            WeatherChatResponse errorResponse = new WeatherChatResponse(
                    question,
                    null,
                    false,
                    "å¤©æ°£æŸ¥è©¢å¤±æ•—ï¼š" + e.getMessage(),
                    System.currentTimeMillis()
            );

            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
                    .body(errorResponse);
        }
    }

    /**
     * ç›´æ¥å–å¾—å¤©æ°£è³‡è¨Š
     */
    @GetMapping("/current")
    public ResponseEntity<WeatherInfo> getCurrentWeather(@RequestParam String location) {
        WeatherInfo weatherInfo = weatherService.getCurrentWeather(location);

        if (weatherInfo.success()) {
            return ResponseEntity.ok(weatherInfo);
        } else {
            return ResponseEntity.status(HttpStatus.NOT_FOUND).body(weatherInfo);
        }
    }

    /**
     * å–å¾—æº«åº¦æ’è¡Œæ¦œ
     */
    @GetMapping("/temperature-ranking")
    public ResponseEntity<TemperatureRanking> getTemperatureRanking(
            @RequestParam(defaultValue = "10") Integer topCount) {

        TemperatureRanking ranking = weatherService.getTemperatureRanking(topCount);
        return ResponseEntity.ok(ranking);
    }

    public record WeatherChatResponse(
            String question,
            String answer,
            boolean success,
            String error,
            long timestamp
    ) {}
}
```

---

## ğŸ§ª æ¸¬è©¦æ‡‰ç”¨

### API æ¸¬è©¦ç¯„ä¾‹

```bash
# 1. åŸºæœ¬å¤©æ°£æŸ¥è©¢ï¼ˆè‡ªç„¶èªè¨€ï¼‰
curl "http://localhost:8080/api/weather/chat?question=æ¡ƒåœ’ç›®å‰å¤©æ°£å¦‚ä½•ï¼Ÿ"

# 2. æº«åº¦æ’è¡ŒæŸ¥è©¢
curl "http://localhost:8080/api/weather/chat?question=å…¨å°æœ€é«˜æº«çš„å‰ä¸‰åæ˜¯å“ªäº›åœ°æ–¹ï¼Ÿ"

# 3. ç›´æ¥ API èª¿ç”¨
curl "http://localhost:8080/api/weather/current?location=å°åŒ—"

# 4. æº«åº¦æ’è¡Œæ¦œ
curl "http://localhost:8080/api/weather/temperature-ranking?topCount=5"
```

### å›æ‡‰ç¯„ä¾‹

**å¤©æ°£æŸ¥è©¢å›æ‡‰**:

```json
{
  "question": "æ¡ƒåœ’ç›®å‰å¤©æ°£å¦‚ä½•ï¼Ÿ",
  "answer": "ğŸ“ åœ°é»ï¼šæ¡ƒåœ’\nğŸŒ¡ï¸ æº«åº¦ï¼š28.5Â°C\nğŸ’§ æ¿•åº¦ï¼š72%\nâ˜ï¸ å¤©æ°£ï¼šå¤šé›²\nğŸŒ§ï¸ é™é›¨é‡ï¼š0.0mm\nğŸ’¨ é¢¨å‘ï¼šæ±å—é¢¨\nğŸŒªï¸ é¢¨é€Ÿï¼š2.3m/s\nâ° è§€æ¸¬æ™‚é–“ï¼š2025-01-29 14:30",
  "success": true,
  "error": null,
  "timestamp": 1706518200000
}
```

### AI æ™ºèƒ½å»ºè­°ç¯„ä¾‹

```
ç”¨æˆ¶ï¼šã€Œæ˜å¤©è¦å»å°ä¸­ï¼Œéœ€è¦å¸¶é›¨å…·å—ï¼Ÿã€

AI å›æ‡‰ï¼š
ğŸŒ¦ï¸ **å°ä¸­å¤©æ°£å»ºè­°**

ğŸ“… **ç›®å‰å¤©æ°£**
ğŸŒ¡ï¸ æº«åº¦ï¼š25Â°C
â˜ï¸ å¤©æ°£ï¼šæ™´æ™‚å¤šé›²
ğŸ’§ æ¿•åº¦ï¼š65%
ğŸ’¨ é¢¨åŠ›ï¼šå¾®é¢¨

â˜‚ï¸ **æ”œå¸¶å»ºè­°**
âœ… å»ºè­°æ”œå¸¶è¼•ä¾¿é›¨å…·
- é›–ç„¶ç›®å‰å¤©æ°£ç©©å®šï¼Œä½†åˆå¾Œå¯èƒ½æœ‰å±€éƒ¨é™£é›¨
- å¯æº–å‚™æ‘ºç–Šå‚˜ä»¥å‚™ä¸æ™‚ä¹‹éœ€
- ç©¿è‘—è¼•è–„é€æ°£çš„è¡£ç‰©å³å¯

ğŸ¯ **å‡ºè¡Œå»ºè­°**
- é©åˆæˆ¶å¤–æ´»å‹•
- æ³¨æ„é˜²æ›¬
- å¤šè£œå……æ°´åˆ†
```

---

## ğŸ”§ éŒ¯èª¤è™•ç†ç­–ç•¥

### å¸¸è¦‹éŒ¯èª¤å’Œè™•ç†

```mermaid
graph TD
    A[API èª¿ç”¨] --> B{æˆåŠŸ?}
    B -->|æ˜¯| C[è§£æè³‡æ–™]
    B -->|å¦| D[API éŒ¯èª¤]

    C --> E{è³‡æ–™å®Œæ•´?}
    E -->|æ˜¯| F[è¿”å›çµæœ]
    E -->|å¦| G[è³‡æ–™ç¼ºå¤±]

    D --> H[è¨˜éŒ„æ—¥èªŒ]
    G --> H
    H --> I[è¿”å›å‹å–„éŒ¯èª¤è¨Šæ¯]

    style B fill:#fff4e6
    style E fill:#fff4e6
    style F fill:#e8f5e9
    style I fill:#ffcccc
```

### éŒ¯èª¤è™•ç†æœ€ä½³å¯¦è¸

1. **API èª¿ç”¨å¤±æ•—**
   - è¨˜éŒ„è©³ç´°éŒ¯èª¤æ—¥èªŒ
   - è¿”å›å‹å–„çš„éŒ¯èª¤è¨Šæ¯çµ¦ç”¨æˆ¶
   - ä¸æš´éœ²å…§éƒ¨éŒ¯èª¤ç´°ç¯€

2. **è³‡æ–™ç¼ºå¤±**
   - å„ªé›…é™ç´šï¼ˆè¿”å›éƒ¨åˆ†è³‡æ–™ï¼‰
   - æ¨™è¨˜ç¼ºå¤±çš„æ¬„ä½
   - æä¾›æ›¿ä»£æ–¹æ¡ˆ

3. **ç¶²è·¯è¶…æ™‚**
   - è¨­å®šåˆç†çš„è¶…æ™‚æ™‚é–“
   - å¯¦ç¾é‡è©¦æ©Ÿåˆ¶
   - æä¾›å¿«å–å‚™æ´

---

## ğŸ“ é‡é»å›é¡§

### æ ¸å¿ƒæ¦‚å¿µ

âœ… **API æ•´åˆæµç¨‹** - å¾è¨»å†Šåˆ°èª¿ç”¨çš„å®Œæ•´æµç¨‹
âœ… **JSON è³‡æ–™è§£æ** - è™•ç†è¤‡é›œçš„å·¢ç‹€çµæ§‹
âœ… **å·¥å…·æ•´åˆ** - å°‡ API æ•´åˆåˆ° Spring AI å·¥å…·ç³»çµ±
âœ… **éŒ¯èª¤è™•ç†** - è™•ç†å„ç¨®ç•°å¸¸æƒ…æ³

### é—œéµæŠ€è¡“é»

| æŠ€è¡“é» | é‡è¦æ€§ | é›£åº¦ | èªªæ˜ |
|--------|--------|------|------|
| **API Key ç®¡ç†** | â­â­â­ | ä½ | ä½¿ç”¨ç’°å¢ƒè®Šæ•¸ä¿è­·æ•æ„Ÿè³‡è¨Š |
| **JSON è§£æ** | â­â­â­ | ä¸­ | Jackson JsonNode è™•ç† |
| **@Tool è¨»è§£** | â­â­â­ | ä½ | å°‡æœå‹™æ–¹æ³•è½‰ç‚º AI å·¥å…· |
| **éŒ¯èª¤è™•ç†** | â­â­ | ä¸­ | å„ªé›…çš„ç•°å¸¸è™•ç† |

### æœ€ä½³å¯¦è¸

**1. API å®‰å…¨ç®¡ç†**
- ğŸ”‘ ä½¿ç”¨ç’°å¢ƒè®Šæ•¸å„²å­˜ API Key
- ğŸš« ä¸è¦å°‡ API Key æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶
- ğŸ“Š ç›£æ§ API ä½¿ç”¨é‡å’Œé…é¡

**2. è³‡æ–™è™•ç†å„ªåŒ–**
- ğŸ¯ ç²¾ç¢ºè§£æ JSON çµæ§‹
- ğŸ›¡ï¸ é˜²ç¦¦æ€§ç·¨ç¨‹ï¼ˆè™•ç† null å’Œç•°å¸¸ï¼‰
- ğŸ“ çµ±ä¸€å–®ä½ï¼ˆæº«åº¦ã€é¢¨é€Ÿç­‰ï¼‰

**3. AI å·¥å…·è¨­è¨ˆ**
- ğŸ’¬ æ¸…æ™°çš„å·¥å…·æè¿°ï¼ˆ@Tool descriptionï¼‰
- ğŸ“Š çµæ§‹åŒ–çš„å›æ‡‰æ ¼å¼
- ğŸ¨ ä½¿ç”¨è¡¨æƒ…ç¬¦è™Ÿå¢å¼·å¯è®€æ€§
- ğŸ’¡ æä¾›æ™ºèƒ½å»ºè­°

---

## ğŸš€ ä¸‹ä¸€æ­¥

å®Œæˆæœ¬ç¯€å¾Œï¼Œæ‚¨å·²ç¶“æŒæ¡äº† API æ•´åˆçš„å¯¦æˆ°æŠ€å·§ã€‚æ¥ä¸‹ä¾†éœ€è¦å­¸ç¿’çµæ§‹åŒ–è³‡æ–™è™•ç†ï¼š

**çµæ§‹åŒ–è³‡æ–™è¼¸å‡ºèˆ‡è½‰æ›**
- å­¸ç¿’ä½¿ç”¨ BeanOutputConverter å°‡ AI è¼¸å‡ºè½‰æ›ç‚º Java ç‰©ä»¶
- æŒæ¡å®šç¾©è¼¸å‡ºè³‡æ–™çµæ§‹å’Œé©—è­‰è¦å‰‡
- ç†è§£å¦‚ä½•è™•ç† AI è¼¸å‡ºçš„è§£æéŒ¯èª¤å’Œç•°å¸¸
- å­¸ç¿’å¯¦ä½œè¤‡é›œçš„è³‡æ–™èƒå–å’Œè½‰æ›ä»»å‹™
- æŒæ¡çµæ§‹åŒ–è¼¸å‡ºåœ¨è¡¨å–®å¡«å¯«ã€è³‡æ–™åˆ†æç­‰å ´æ™¯çš„æ‡‰ç”¨

**é‚å‘ AI è¨˜æ†¶ç³»çµ±**
- ç†è§£ AI è¨˜æ†¶ç³»çµ±çš„æ ¸å¿ƒæ¦‚å¿µå’Œæ¶æ§‹è¨­è¨ˆ
- å­¸ç¿’ ChatMemory çŸ­æœŸè¨˜æ†¶çš„å¯¦ä½œæ–¹å¼
- æŒæ¡å°è©±æ­·å²çš„å„²å­˜å’Œç®¡ç†ç­–ç•¥
- ç†è§£å¦‚ä½•å¯¦ç¾ä¸Šä¸‹æ–‡æ„ŸçŸ¥çš„æ™ºèƒ½å°è©±
- å­¸ç¿’ Advisor æ©Ÿåˆ¶ï¼Œç‚ºè¨˜æ†¶ç³»çµ±å¥ å®šåŸºç¤

å®Œæˆé€™äº›å­¸ç¿’å¾Œï¼Œæ‚¨å°‡æº–å‚™å¥½é€²å…¥ç¬¬å…­ç« ï¼Œå­¸ç¿’å¦‚ä½•è®“ AI æ“æœ‰è¨˜æ†¶èƒ½åŠ›ï¼Œå»ºç«‹çœŸæ­£æ™ºèƒ½çš„å°è©±ç³»çµ±ã€‚

---

**åƒè€ƒè³‡æ–™**:
- [ä¸­å¤®æ°£è±¡å±€é–‹æ”¾è³‡æ–™å¹³å°](https://opendata.cwa.gov.tw/index)
- [Spring AI Tool Calling æ–‡ä»¶](https://docs.spring.io/spring-ai/reference/api/tools.html)
- [Jackson JSON è™•ç†](https://github.com/FasterXML/jackson)
