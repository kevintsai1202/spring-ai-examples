# 5.7 Function Calling (ä¸­) - è®€å–ä¼æ¥­è³‡æ–™

> **å°æ‡‰ç¯„ä¾‹**: `chapter5-spring-ai-advanced`
> **é›£åº¦**: â­â­â­â­â˜†

---

## ğŸ“š æœ¬ç« æ¦‚è¦

Tool Calling æ˜¯ Spring AI æœ€å¼·å¤§çš„åŠŸèƒ½ä¹‹ä¸€,è®“ AI èƒ½å¤ èª¿ç”¨å¤–éƒ¨å·¥å…·å’Œå­˜å–ä¼æ¥­è³‡æ–™ã€‚é€éé€™å€‹æ©Ÿåˆ¶,AI å¯ä»¥çªç ´è‡ªèº«çŸ¥è­˜é™åˆ¶,æˆç‚ºçœŸæ­£çš„ä¼æ¥­æ™ºèƒ½åŠ©æ‰‹ã€‚

**å­¸ç¿’ç›®æ¨™**:
- ç†è§£ Tool Calling çš„å·¥ä½œåŸç†
- æŒæ¡ @Tool è¨»è§£çš„é€²éšä½¿ç”¨
- å¯¦ç¾ä¼æ¥­è³‡æ–™å­˜å–å·¥å…·
- å»ºç«‹å¤šå·¥å…·å”ä½œç³»çµ±
- è¨­è¨ˆæ™ºèƒ½å•†æ¥­åˆ†æå¹³å°

---

## ğŸ¯ ç‚ºä»€éº¼éœ€è¦ Tool Calling?

### AI çš„å±€é™æ€§

```mermaid
graph TD
    A[ç”¨æˆ¶æå•] --> B{AI çŸ¥è­˜ç¯„åœ?}
    B -->|çŸ¥è­˜å…§| C[ç›´æ¥å›ç­”]
    B -->|çŸ¥è­˜å¤–| D[ç„¡æ³•å›ç­”]

    E[ç”¨æˆ¶æå•] --> F{éœ€è¦å³æ™‚è³‡æ–™?}
    F -->|éœ€è¦| G[Tool Calling]
    F -->|ä¸éœ€è¦| H[ä½¿ç”¨è¨“ç·´è³‡æ–™]

    G --> I[èª¿ç”¨ä¼æ¥­ API]
    I --> J[ç²å–æœ€æ–°è³‡æ–™]
    J --> K[AI åˆ†æå›æ‡‰]

    style D fill:#ffcdd2
    style K fill:#c8e6c9
```

**å‚³çµ± AI çš„å•é¡Œ**:
- âŒ çŸ¥è­˜æœ‰æˆªæ­¢æ—¥æœŸï¼ˆå¦‚ 2024å¹´1æœˆï¼‰
- âŒ ç„¡æ³•å­˜å–ä¼æ¥­å…§éƒ¨è³‡æ–™
- âŒ ä¸èƒ½åŸ·è¡Œå¯¦éš›æ“ä½œ
- âŒ ç„¡æ³•æ•´åˆå¤–éƒ¨ç³»çµ±

**Tool Calling çš„åƒ¹å€¼**:
- âœ… å³æ™‚å­˜å–æœ€æ–°è³‡æ–™
- âœ… æ•´åˆä¼æ¥­å…§éƒ¨ç³»çµ±
- âœ… åŸ·è¡Œå¯¦éš›æ¥­å‹™æ“ä½œ
- âœ… å¤šç³»çµ±å”åŒå·¥ä½œ

---

## ğŸ—ï¸ Tool Calling æ¶æ§‹

### æ ¸å¿ƒæ¦‚å¿µ

```mermaid
graph TD
    A[ç”¨æˆ¶è«‹æ±‚] --> B[ChatClient]
    B --> C{éœ€è¦å·¥å…·?}

    C -->|éœ€è¦| D[é¸æ“‡åˆé©å·¥å…·]
    C -->|ä¸éœ€è¦| E[ç›´æ¥å›æ‡‰]

    D --> F[åŸ·è¡Œå·¥å…·]
    F --> G[ç²å–çµæœ]
    G --> H[AI è™•ç†çµæœ]
    H --> I[ç”Ÿæˆå›æ‡‰]

    style C fill:#e1f5ff
    style F fill:#fff4e6
    style I fill:#c8e6c9
```

### å·¥ä½œæµç¨‹

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ¶
    participant C as ChatClient
    participant AI as AI Model
    participant T as Tool

    U->>C: "å…¬å¸2024å¹´éŠ·é‡?"
    C->>AI: ç™¼é€è«‹æ±‚ + å·¥å…·å®šç¾©

    rect rgb(225, 245, 254)
    Note over AI: AI åˆ†æéœ€æ±‚
    AI->>AI: éœ€è¦èª¿ç”¨å·¥å…·
    AI-->>C: tool_call(year=2024)
    end

    C->>T: getProductSales("2024")
    T->>T: æŸ¥è©¢è³‡æ–™åº«
    T-->>C: éŠ·å”®è³‡æ–™

    C->>AI: æä¾›å·¥å…·çµæœ
    AI->>AI: åˆ†æè³‡æ–™
    AI-->>C: åˆ†æå ±å‘Š

    C-->>U: "2024å¹´ç¸½éŠ·é‡54,500å°..."
```

---

## ğŸ’» åŸºç¤å·¥å…·å¯¦ç¾

### 1. ç°¡å–®å·¥å…· - æ—¥æœŸæ™‚é–“

```java
// å°æ‡‰ç¯„ä¾‹: chapter5-spring-ai-advanced/.../tools/DateTimeTools.java:15

@Component
public class DateTimeTools {

    /**
     * ç²å–ç•¶å‰æ—¥æœŸæ™‚é–“
     */
    @Tool(description = "Get the current date and time in specified timezone. " +
          "Supports timezones like 'Asia/Taipei', 'America/New_York', 'Europe/London'.")
    public String getCurrentDateTime(String timezone) {
        try {
            ZoneId zoneId = ZoneId.of(timezone);
            ZonedDateTime now = ZonedDateTime.now(zoneId);

            return now.format(
                DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss z")
            );
        } catch (Exception e) {
            return "Invalid timezone: " + timezone;
        }
    }
}
```

**å¯¦ç¾è¦é»**:
1. âœ… ä½¿ç”¨ `@Tool` è¨»è§£æ¨™è¨˜æ–¹æ³•
2. âœ… `description` å¿…é ˆç”¨**è‹±æ–‡**æè¿°åŠŸèƒ½
3. âœ… åƒæ•¸å’Œè¿”å›å€¼æœƒè‡ªå‹•åºåˆ—åŒ–
4. âœ… æ–¹æ³•å¿…é ˆæ˜¯ public

### 2. ä¼æ¥­è³‡æ–™å·¥å…· - ç”¢å“éŠ·å”®

```java
// å°æ‡‰ç¯„ä¾‹: chapter5-spring-ai-advanced/.../tools/ProductSalesTools.java:25

@Component
@RequiredArgsConstructor
public class ProductSalesTools {

    private final EnterpriseDataService dataService;

    /**
     * æŸ¥è©¢ç”¢å“éŠ·å”®è³‡æ–™
     */
    @Tool(description = "Get company product sales information by year and product model. " +
          "Can filter by year (e.g., '2023', '2024') and product (model or name). " +
          "Returns detailed sales data including quantity, revenue, and product information.")
    public ProductSalesResponse getProductSales(String year, String product) {

        log.info("æŸ¥è©¢ç”¢å“éŠ·å”®ï¼šå¹´ä»½={}, ç”¢å“={}", year, product);

        // å¾ä¼æ¥­ç³»çµ±ç²å–è³‡æ–™
        List<Product> products = dataService.filterProducts(year, product);

        // è¨ˆç®—çµ±è¨ˆè³‡æ–™
        int totalQuantity = products.stream()
                .mapToInt(Product::getQuantity)
                .sum();

        BigDecimal totalRevenue = products.stream()
                .map(Product::getRevenue)
                .reduce(BigDecimal.ZERO, BigDecimal::add);

        // å»ºç«‹å›æ‡‰
        return ProductSalesResponse.builder()
                .products(products)
                .totalQuantity(totalQuantity)
                .totalRevenue(totalRevenue)
                .queryYear(year)
                .queryProduct(product)
                .build();
    }
}
```

### 3. è³‡æ–™æ¨¡å‹è¨­è¨ˆ

```java
// å°æ‡‰ç¯„ä¾‹: chapter5-spring-ai-advanced/.../model/Product.java:12

@Data
@Builder
public class Product {

    @JsonProperty("year")
    @JsonPropertyDescription("éŠ·å”®å¹´ä»½")
    private String year;

    @JsonProperty("model")
    @JsonPropertyDescription("ç”¢å“å‹è™Ÿ")
    private String model;

    @JsonProperty("name")
    @JsonPropertyDescription("ç”¢å“åç¨±")
    private String name;

    @JsonProperty("quantity")
    @JsonPropertyDescription("éŠ·å”®æ•¸é‡")
    private Integer quantity;

    @JsonProperty("revenue")
    @JsonPropertyDescription("éŠ·å”®é‡‘é¡")
    private BigDecimal revenue;

    @JsonProperty("category")
    @JsonPropertyDescription("ç”¢å“é¡åˆ¥")
    private String category;
}
```

**é—œéµè¨»è§£**:
- `@JsonProperty`: æŒ‡å®š JSON æ¬„ä½åç¨±
- `@JsonPropertyDescription`: **é‡è¦!** è®“ AI ç†è§£æ¬„ä½ç”¨é€”
- `@JsonClassDescription`: é¡åˆ¥å±¤ç´šçš„æè¿°

---

## ğŸ”§ é€²éšå·¥å…·é–‹ç™¼

### å¤šå·¥å…·å”ä½œé…ç½®

```java
// å°æ‡‰ç¯„ä¾‹: chapter5-spring-ai-advanced/.../config/AiConfig.java:28

@Configuration
@RequiredArgsConstructor
public class AiConfig {

    private final ProductSalesTools productSalesTools;
    private final DateTimeTools dateTimeTools;
    private final CalculatorTools calculatorTools;

    /**
     * ä¼æ¥­ç´š ChatClient é…ç½®
     */
    @Bean
    public ChatClient enterpriseChatClient(ChatModel chatModel) {
        return ChatClient.builder(chatModel)
                .defaultTools(
                    productSalesTools,    // ç”¢å“éŠ·å”®å·¥å…·
                    dateTimeTools,        // æ—¥æœŸæ™‚é–“å·¥å…·
                    calculatorTools       // è¨ˆç®—å·¥å…·
                )
                .defaultSystem("""
                    ä½ æ˜¯å°ˆæ¥­çš„ä¼æ¥­è³‡æ–™åˆ†æå¸«ã€‚

                    ç•¶ç”¨æˆ¶è©¢å•ä¼æ¥­è³‡æ–™æ™‚:
                    1. ä½¿ç”¨é©ç•¶çš„å·¥å…·ç²å–æœ€æ–°è³‡æ–™
                    2. é€²è¡Œæ·±å…¥çš„è³‡æ–™åˆ†æ
                    3. æä¾›æ¸…æ™°çš„æ´å¯Ÿå’Œå»ºè­°

                    å¯ç”¨å·¥å…·:
                    - ç”¢å“éŠ·å”®è³‡æ–™æŸ¥è©¢
                    - æ—¥æœŸæ™‚é–“æŸ¥è©¢
                    - æ•¸å­¸è¨ˆç®—
                    """)
                .build();
    }
}
```

### çµ±è¨ˆåˆ†æå·¥å…·

```java
// å°æ‡‰ç¯„ä¾‹: chapter5-spring-ai-advanced/.../tools/ProductSalesTools.java:95

/**
 * ç²å–éŠ·å”®çµ±è¨ˆåˆ†æ
 */
@Tool(description = "Get sales statistics and analysis for a specific year. " +
      "Returns top-selling products, category breakdown, and growth metrics.")
public SalesStatistics getSalesStatistics(String year) {

    List<Product> products = dataService.filterProducts(year, null);

    // è¨ˆç®—å„é¡åˆ¥çµ±è¨ˆ
    List<CategoryStat> categoryStats = products.stream()
            .collect(Collectors.groupingBy(Product::getCategory))
            .entrySet().stream()
            .map(entry -> {
                String category = entry.getKey();
                List<Product> categoryProducts = entry.getValue();

                int quantity = categoryProducts.stream()
                        .mapToInt(Product::getQuantity)
                        .sum();

                BigDecimal revenue = categoryProducts.stream()
                        .map(Product::getRevenue)
                        .reduce(BigDecimal.ZERO, BigDecimal::add);

                double percentage = calculatePercentage(quantity, products);

                return CategoryStat.builder()
                        .category(category)
                        .quantity(quantity)
                        .revenue(revenue)
                        .percentage(percentage)
                        .build();
            })
            .collect(Collectors.toList());

    // å–å¾—éŠ·é‡å‰äº”å
    List<Product> topProducts = products.stream()
            .sorted((p1, p2) -> Integer.compare(
                p2.getQuantity(), p1.getQuantity()))
            .limit(5)
            .collect(Collectors.toList());

    return SalesStatistics.builder()
            .topProducts(topProducts)
            .categoryStats(categoryStats)
            .build();
}
```

### å¹´åº¦æ¯”è¼ƒå·¥å…·

```java
// å°æ‡‰ç¯„ä¾‹: chapter5-spring-ai-advanced/.../tools/ProductSalesTools.java:145

/**
 * æ¯”è¼ƒä¸åŒå¹´ä»½çš„éŠ·å”®è¡¨ç¾
 */
@Tool(description = "Compare sales performance between two years. " +
      "Returns detailed comparison including growth rates and product performance changes.")
public String compareSalesByYear(String year1, String year2) {

    List<Product> products1 = dataService.filterProducts(year1, null);
    List<Product> products2 = dataService.filterProducts(year2, null);

    int total1 = products1.stream().mapToInt(Product::getQuantity).sum();
    int total2 = products2.stream().mapToInt(Product::getQuantity).sum();

    BigDecimal revenue1 = products1.stream()
            .map(Product::getRevenue)
            .reduce(BigDecimal.ZERO, BigDecimal::add);

    BigDecimal revenue2 = products2.stream()
            .map(Product::getRevenue)
            .reduce(BigDecimal.ZERO, BigDecimal::add);

    double quantityGrowth = calculateGrowthRate(total1, total2);
    double revenueGrowth = calculateGrowthRate(revenue1, revenue2);

    return String.format("""
            å¹´åº¦éŠ·å”®æ¯”è¼ƒåˆ†æ (%s vs %s):
            éŠ·å”®æ•¸é‡ï¼š%d â†’ %d (æˆé•·ç‡ï¼š%.2f%%)
            éŠ·å”®é‡‘é¡ï¼š%s â†’ %s (æˆé•·ç‡ï¼š%.2f%%)
            ç”¢å“æ•¸é‡ï¼š%d â†’ %d
            """,
            year1, year2,
            total1, total2, quantityGrowth,
            revenue1, revenue2, revenueGrowth,
            products1.size(), products2.size()
    );
}
```

---

## ğŸ¬ å¯¦éš›æ‡‰ç”¨å ´æ™¯

### å ´æ™¯ 1ï¼šåŸºç¤éŠ·å”®æŸ¥è©¢

**ç”¨æˆ¶**: "è«‹å‘Šè¨´æˆ‘ 2024 å¹´æ‰€æœ‰ç”¢å“çš„éŠ·å”®æƒ…æ³"

**AI è™•ç†æµç¨‹**:
```mermaid
graph LR
    A[ç”¨æˆ¶è«‹æ±‚] --> B[AI åˆ†æ]
    B --> C[èª¿ç”¨ getProductSales]
    C --> D[ç²å– 2024 è³‡æ–™]
    D --> E[AI åˆ†ææ•¸æ“š]
    E --> F[ç”Ÿæˆå ±å‘Š]

    style C fill:#fff4e6
    style E fill:#e1f5ff
    style F fill:#c8e6c9
```

**AI å›æ‡‰**:
```
ğŸ“Š **2024å¹´éŠ·å”®ç¸½è¦½**
- ç¸½éŠ·å”®æ•¸é‡ï¼š54,500 å°
- ç¸½éŠ·å”®é‡‘é¡ï¼š22.05 å„„å…ƒ
- ç”¢å“ç·šï¼š5 æ¬¾ç”¢å“

ğŸ“ˆ **å„ç”¢å“è¡¨ç¾**
1. PD-1235 å¹³æ¿é›»è…¦ Proï¼š15,000å° (27.5%)
2. PD-1385 æ™ºèƒ½æ‰‹éŒ¶ Ultraï¼š15,000å° (27.5%)
3. PD-1255 ç„¡ç·šè€³æ©Ÿ Proï¼š15,000å° (27.5%)
4. PD-1405 æ™ºèƒ½æ‰‹æ©Ÿ Pro Maxï¼š12,500å° (23.0%)
5. PD-1300 æ™ºèƒ½éŸ³ç®± Homeï¼š12,000å° (22.0%)

ğŸ’¡ **åˆ†ææ´å¯Ÿ**
- ç”¢å“ç·šåˆ†å¸ƒå‡è¡¡ï¼Œå„ç”¢å“éŠ·é‡æ¥è¿‘
- æ™ºèƒ½æ‰‹æ©Ÿå’Œå¹³æ¿é›»è…¦è²¢ç»æœ€å¤šç‡Ÿæ”¶
- ç©¿æˆ´è£ç½®å’Œæ™ºèƒ½å®¶å±…å¸‚å ´è¡¨ç¾å¼·å‹
```

### å ´æ™¯ 2ï¼šè·¨å¹´åº¦æ¯”è¼ƒ

**ç”¨æˆ¶**: "æ¯”è¼ƒä¸€ä¸‹ 2023 å’Œ 2024 å¹´çš„éŠ·å”®è¡¨ç¾"

**å·¥å…·èª¿ç”¨åºåˆ—**:
1. `getProductSales("2023", null)`
2. `getProductSales("2024", null)`
3. `compareSalesByYear("2023", "2024")`

**AI å›æ‡‰**:
```
ğŸ“Š **2023 vs 2024 å¹´åº¦éŠ·å”®æ¯”è¼ƒ**

**æ•´é«”è¡¨ç¾**
- éŠ·å”®æ•¸é‡ï¼š26,500 â†’ 54,500 å° (+105.7%)
- éŠ·å”®é‡‘é¡ï¼š11.45 â†’ 22.05 å„„å…ƒ (+92.6%)
- ç”¢å“ç·šï¼š4 â†’ 5 æ¬¾ç”¢å“

**æˆé•·äº®é»**
1. âœ… éŠ·é‡ç¿»å€å¢é•·ï¼Œå¸‚å ´æ¥å—åº¦æå‡
2. âœ… æ–°å¢æ™ºèƒ½éŸ³ç®±ç”¢å“ç·šæ‹“å±•å¸‚å ´
3. âœ… å¹³æ¿é›»è…¦å¾ 1,500 å°èºå‡è‡³ 15,000 å°

**ç­–ç•¥å»ºè­°**
- ğŸ¯ ç¹¼çºŒæ“´å±•ç”¢å“å¤šæ¨£åŒ–ç­–ç•¥
- ğŸ¯ åŠ å¼·æ™ºèƒ½å®¶å±…å¸‚å ´æŠ•å…¥
- ğŸ¯ å„ªåŒ–ä¾›æ‡‰éˆä»¥æ”¯æ’å¿«é€Ÿå¢é•·
```

### å ´æ™¯ 3ï¼šæ·±åº¦åˆ†æ

**ç”¨æˆ¶**: "åˆ†æç©¿æˆ´è£ç½®é¡åˆ¥çš„å¸‚å ´è¡¨ç¾ï¼Œçµ¦å‡ºç­–ç•¥å»ºè­°"

**å·¥å…·èª¿ç”¨**:
- `getSalesStatistics("2024")`
- é‡å°ç©¿æˆ´è£ç½®é¡åˆ¥é€²è¡Œåˆ†æ

**AI å›æ‡‰**:
```
ğŸ” **ç©¿æˆ´è£ç½®é¡åˆ¥æ·±åº¦åˆ†æ**

**ç”¢å“è¡¨ç¾**
- PD-1385 æ™ºèƒ½æ‰‹éŒ¶ç³»åˆ—
  - 2023: 15,000å° (56.6% å æ¯”)
  - 2024: 15,000å° (27.5% å æ¯”)

**å¸‚å ´æ´å¯Ÿ**
1. **çµ•å°é‡ç©©å®š**: éŠ·é‡ç¶­æŒåœ¨ 15,000 å°æ°´å¹³
2. **ç›¸å°å æ¯”ä¸‹é™**: å¾ 56.6% é™è‡³ 27.5%
3. **ç”¢å“å‡ç´šæˆåŠŸ**: Sport â†’ Ultraï¼Œå–®åƒ¹æå‡ 50%
4. **å¸‚å ´è¶¨æ–¼é£½å’Œ**: éœ€è¦æ–°çš„å¢é•·é»

**ç«¶çˆ­åˆ†æ**
- å¸‚å ´ç«¶çˆ­åŠ åŠ‡
- åŠŸèƒ½åŒè³ªåŒ–åš´é‡
- åƒ¹æ ¼æ•æ„Ÿåº¦æé«˜

**ç­–ç•¥å»ºè­°**
1. ğŸ“Š **ç”¢å“å·®ç•°åŒ–**
   - é–‹ç™¼å°ˆæ¥­é‹å‹•ç‰ˆæœ¬
   - å¼·åŒ–å¥åº·ç›£æ¸¬åŠŸèƒ½
   - æ¨å‡ºæ™‚å°šæ¬¾å¼

2. ğŸ”„ **ç”Ÿæ…‹ç³»çµ±æ•´åˆ**
   - èˆ‡æ‰‹æ©Ÿã€å¹³æ¿æ·±åº¦è¯å‹•
   - é–‹ç™¼å°ˆå±¬ App æœå‹™
   - å»ºç«‹ç”¨æˆ¶ç¤¾ç¾¤

3. ğŸ’° **å•†æ¥­æ¨¡å¼å‰µæ–°**
   - å¼•å…¥è¨‚é–±æœå‹™
   - æ¨å‡ºå¥åº·ç®¡ç†å¥—é¤
   - ä¼æ¥­åœ˜è³¼æ–¹æ¡ˆ

4. ğŸŒ **å¸‚å ´æ‹“å±•**
   - é€²å…¥æ–°èˆˆå¸‚å ´
   - é‡å°éŠ€é«®æ—é–‹ç™¼ç”¢å“
   - æ‹“å±•ä¼æ¥­å®¢æˆ¶
```

---

## ğŸ’¡ æœ€ä½³å¯¦è¸

### 1. å·¥å…·è¨­è¨ˆåŸå‰‡

**âœ… è‰¯å¥½çš„å·¥å…·è¨­è¨ˆ**:
```java
@Tool(description = "Get product sales data by year and optional product filter. " +
      "Year format: 'YYYY' (e.g., '2024'). " +
      "Product can be model number (e.g., 'PD-1234') or name (e.g., 'Laptop'). " +
      "Returns list of products with quantity, revenue, and category information.")
public ProductSalesResponse getProductSales(String year, String product)
```

**âŒ ä¸è‰¯çš„å·¥å…·è¨­è¨ˆ**:
```java
@Tool(description = "ç²å–è³‡æ–™") // âŒ ä¸­æ–‡æè¿°
public List<Object> getData(Map params) // âŒ é¡å‹ä¸æ˜ç¢º
```

**è¨­è¨ˆåŸå‰‡**:
1. âœ… Description ä½¿ç”¨**è‹±æ–‡**
2. âœ… æ˜ç¢ºèªªæ˜åƒæ•¸æ ¼å¼å’Œç¯„ä¾‹
3. âœ… æè¿°è¿”å›å€¼çµæ§‹
4. âœ… ä½¿ç”¨æ˜ç¢ºçš„é¡å‹ï¼ˆé¿å… Objectã€Mapï¼‰

### 2. åƒæ•¸é©—è­‰

```java
@Tool(description = "Calculate percentage between two numbers")
public double calculatePercentage(Double value, Double total) {
    // åƒæ•¸é©—è­‰
    if (value == null || total == null) {
        throw new IllegalArgumentException("åƒæ•¸ä¸èƒ½ç‚ºç©º");
    }

    if (total == 0) {
        throw new IllegalArgumentException("ç¸½æ•¸ä¸èƒ½ç‚ºé›¶");
    }

    if (value < 0 || total < 0) {
        throw new IllegalArgumentException("åƒæ•¸ä¸èƒ½ç‚ºè² æ•¸");
    }

    return (value / total) * 100;
}
```

### 3. éŒ¯èª¤è™•ç†

```java
@Tool(description = "Get product details by model number")
public ProductDetails getProductDetails(String model) {
    try {
        ProductDetails details = dataService.getProduct(model);

        if (details == null) {
            // è¿”å›æœ‰æ„ç¾©çš„éŒ¯èª¤è¨Šæ¯,è€Œä¸æ˜¯æ‹‹å‡ºç•°å¸¸
            return ProductDetails.error(
                "Product not found: " + model
            );
        }

        return details;

    } catch (Exception e) {
        log.error("ç²å–ç”¢å“è©³æƒ…å¤±æ•—: {}", model, e);

        // è¿”å›éŒ¯èª¤è³‡è¨Š,è®“ AI å¯ä»¥ç†è§£
        return ProductDetails.error(
            "Error retrieving product: " + e.getMessage()
        );
    }
}
```

### 4. æ•ˆèƒ½å„ªåŒ–

```java
@Service
public class EnterpriseDataService {

    // ä½¿ç”¨å¿«å–é¿å…é‡è¤‡æŸ¥è©¢
    @Cacheable(value = "productSales", key = "#year + ':' + #product")
    public List<Product> filterProducts(String year, String product) {
        // è³‡æ–™åº«æŸ¥è©¢é‚è¼¯
        return queryDatabase(year, product);
    }

    // æ‰¹æ¬¡æŸ¥è©¢å„ªåŒ–
    public Map<String, List<Product>> batchFilterProducts(
            List<String> years) {

        // ä¸€æ¬¡æŸ¥è©¢å¤šå€‹å¹´ä»½
        return years.stream()
                .collect(Collectors.toMap(
                    year -> year,
                    year -> filterProducts(year, null)
                ));
    }
}
```

---

## ğŸ“Š å·¥å…·è¨­è¨ˆæ¨¡å¼

### æ¨¡å¼ 1ï¼šæŸ¥è©¢å·¥å…·

```java
/**
 * ç‰¹é»: åªè®€æ“ä½œ,ä¸ä¿®æ”¹è³‡æ–™
 * é©ç”¨: è³‡æ–™æŸ¥è©¢ã€å ±è¡¨ç”Ÿæˆ
 */
@Tool(description = "Query pattern: read-only data retrieval")
public DataResponse queryData(QueryRequest request) {
    return dataService.query(request);
}
```

### æ¨¡å¼ 2ï¼šæ“ä½œå·¥å…·

```java
/**
 * ç‰¹é»: åŸ·è¡Œæ¥­å‹™æ“ä½œ
 * é©ç”¨: è³‡æ–™æ›´æ–°ã€æµç¨‹è§¸ç™¼
 */
@Tool(description = "Action pattern: perform business operation")
public OperationResult performOperation(OperationRequest request) {
    // é©—è­‰æ¬Šé™
    validatePermission(request);

    // åŸ·è¡Œæ“ä½œ
    Result result = businessService.execute(request);

    // è¨˜éŒ„æ—¥èªŒ
    auditLog.record(request, result);

    return result;
}
```

### æ¨¡å¼ 3ï¼šèšåˆå·¥å…·

```java
/**
 * ç‰¹é»: æ•´åˆå¤šå€‹è³‡æ–™æº
 * é©ç”¨: å„€è¡¨æ¿ã€ç¶œåˆå ±è¡¨
 */
@Tool(description = "Aggregation pattern: combine multiple data sources")
public AggregatedReport generateReport(ReportRequest request) {
    // ä¸¦è¡Œç²å–å¤šå€‹è³‡æ–™æº
    CompletableFuture<SalesData> salesFuture =
        CompletableFuture.supplyAsync(() -> getSalesData(request));

    CompletableFuture<InventoryData> inventoryFuture =
        CompletableFuture.supplyAsync(() -> getInventoryData(request));

    CompletableFuture<CustomerData> customerFuture =
        CompletableFuture.supplyAsync(() -> getCustomerData(request));

    // ç­‰å¾…æ‰€æœ‰è³‡æ–™
    CompletableFuture.allOf(
        salesFuture, inventoryFuture, customerFuture
    ).join();

    // æ•´åˆå ±è¡¨
    return AggregatedReport.builder()
            .sales(salesFuture.join())
            .inventory(inventoryFuture.join())
            .customer(customerFuture.join())
            .build();
}
```

---

## ğŸ“ é‡é»å›é¡§

### Tool Calling æ ¸å¿ƒåƒ¹å€¼
âœ… **çªç ´çŸ¥è­˜é™åˆ¶**: AI å¯å­˜å–å³æ™‚è³‡æ–™
âœ… **ä¼æ¥­ç³»çµ±æ•´åˆ**: é€£æ¥ ERPã€CRM ç­‰ç³»çµ±
âœ… **æ™ºèƒ½åˆ†æ**: çµåˆè³‡æ–™èˆ‡ AI æ™ºèƒ½
âœ… **éˆæ´»æ“´å±•**: è¼•é¬†æ–°å¢å·¥å…·åŠŸèƒ½

### æŠ€è¡“è¦é»
| è¦é» | èªªæ˜ |
|------|------|
| **@Tool è¨»è§£** | æ¨™è¨˜å·¥å…·æ–¹æ³•,description å¿…é ˆè‹±æ–‡ |
| **é¡å‹æ˜ç¢º** | é¿å…ä½¿ç”¨ Objectã€Map ç­‰æ¨¡ç³Šé¡å‹ |
| **åƒæ•¸é©—è­‰** | ç¢ºä¿è¼¸å…¥è³‡æ–™çš„æœ‰æ•ˆæ€§ |
| **éŒ¯èª¤è™•ç†** | è¿”å›æœ‰æ„ç¾©çš„éŒ¯èª¤è¨Šæ¯ |
| **æ•ˆèƒ½å„ªåŒ–** | ä½¿ç”¨å¿«å–å’Œæ‰¹æ¬¡æŸ¥è©¢ |

### æ‡‰ç”¨å ´æ™¯
- ğŸ“Š **å•†æ¥­æ™ºèƒ½**: éŠ·å”®åˆ†æã€è²¡å‹™å ±è¡¨
- ğŸ¢ **ä¼æ¥­æ•´åˆ**: ERPã€CRMã€äººäº‹ç³»çµ±
- ğŸ¤– **æ™ºèƒ½åŠ©æ‰‹**: å®¢æœã€è³‡æ–™æŸ¥è©¢
- ğŸ“ˆ **è³‡æ–™åˆ†æ**: è¶¨å‹¢é æ¸¬ã€ç•°å¸¸æª¢æ¸¬

---

## ğŸš€ ä¸‹ä¸€æ­¥

å®Œæˆæœ¬ç¯€å¾Œï¼Œæ‚¨å·²ç¶“æŒæ¡äº†é€²éšçš„å·¥å…·é–‹ç™¼æŠ€è¡“ã€‚æ¥ä¸‹ä¾†éœ€è¦å­¸ç¿’å·¥å…·ç”Ÿæ…‹çš„ç®¡ç†ï¼š

**å·¥å…·éˆç®¡ç†èˆ‡ç·¨æ’**
- å­¸ç¿’è¨­è¨ˆå’Œç®¡ç†è¤‡é›œçš„å·¥å…·ç”Ÿæ…‹ç³»çµ±
- æŒæ¡å·¥å…·çš„åˆ†é¡ã€æ¨™ç±¤å’Œçµ„ç¹”ç­–ç•¥
- ç†è§£å¦‚ä½•å¯¦ç¾å·¥å…·çš„å‹•æ…‹ç™¼ç¾å’Œè¼‰å…¥
- å­¸ç¿’è¨­è¨ˆå¤šæ­¥é©Ÿä»»å‹™çš„å·¥å…·ç·¨æ’æµç¨‹
- æŒæ¡å·¥å…·åŸ·è¡Œçš„å„ªå…ˆç´šå’Œè³‡æºç®¡ç†

**çœŸå¯¦ API æ•´åˆå¯¦æˆ°**
- å­¸ç¿’æ•´åˆçœŸå¯¦çš„ç¬¬ä¸‰æ–¹ API æœå‹™ï¼ˆå¤©æ°£ã€åœ°åœ–ã€é‡‘èç­‰ï¼‰
- æŒæ¡ API èªè­‰ã€é™æµã€éŒ¯èª¤è™•ç†çš„æœ€ä½³å¯¦è¸
- ç†è§£å¦‚ä½•è¨­è¨ˆ API èª¿ç”¨çš„å¿«å–å’Œé‡è©¦æ©Ÿåˆ¶
- å­¸ç¿’è™•ç† API å›æ‡‰çš„è§£æå’Œè½‰æ›
- æŒæ¡ API æ•´åˆçš„å®‰å…¨æ€§å’Œåˆè¦æ€§è¦æ±‚

å®Œæˆé€™äº›å­¸ç¿’å¾Œï¼Œæ‚¨å°‡èƒ½å¤ å»ºç«‹çœŸæ­£å¯¦ç”¨çš„ AI æ™ºèƒ½åŠ©æ‰‹æ‡‰ç”¨ã€‚

---

**åƒè€ƒè³‡æ–™**:
- [Spring AI Tool Calling](https://docs.spring.io/spring-ai/reference/api/functions.html)
- [Tool Calling Best Practices](https://platform.openai.com/docs/guides/function-calling)
- [Enterprise AI Integration Patterns](https://docs.spring.io/spring-ai/reference/concepts.html)
