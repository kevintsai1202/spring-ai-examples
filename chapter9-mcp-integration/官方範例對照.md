# Spring AI MCP å®˜æ–¹ç¯„ä¾‹å°ç…§

## ğŸ“š åƒè€ƒä¾†æº
- **è·¯å¾‘**: `D:\GitHub\spring-ai-examples\model-context-protocol`
- **å®˜æ–¹ Repo**: https://github.com/spring-projects/spring-ai-examples

## ğŸ” å·²é©—è­‰çš„å®˜æ–¹ç¯„ä¾‹

### 1. Brave Chatbot (Spring AI 1.0.1)
**è·¯å¾‘**: `model-context-protocol/web-search/brave-chatbot`

#### pom.xml
```xml
<properties>
    <java.version>17</java.version>
</properties>

<dependencyManagement>
    <dependencies>
        <dependency>
            <groupId>org.springframework.ai</groupId>
            <artifactId>spring-ai-bom</artifactId>
            <version>1.0.1</version>  <!-- âœ… æˆ‘å€‘ç”¨ 1.0.3ï¼Œç›¸å®¹ -->
            <type>pom</type>
            <scope>import</scope>
        </dependency>
    </dependencies>
</dependencyManagement>

<dependencies>
    <dependency>
        <groupId>org.springframework.ai</groupId>
        <artifactId>spring-ai-starter-mcp-client</artifactId>
    </dependency>
    <dependency>
        <groupId>org.springframework.ai</groupId>
        <artifactId>spring-ai-starter-model-anthropic</artifactId>
    </dependency>
</dependencies>
```

#### Application.javaï¼ˆæ ¸å¿ƒæ¨¡å¼ï¼‰
```java
package org.springframework.ai.mcp.samples.brave;

import io.modelcontextprotocol.client.McpSyncClient;  // âœ… MCP Java SDK
import org.springframework.ai.chat.client.ChatClient;
import org.springframework.ai.mcp.SyncMcpToolCallbackProvider;  // âœ… Spring AI MCP
import org.springframework.boot.CommandLineRunner;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.context.annotation.Bean;
import java.util.List;

@SpringBootApplication
public class Application {

    @Bean
    public CommandLineRunner chatbot(ChatClient.Builder chatClientBuilder,
                                      List<McpSyncClient> mcpSyncClients) {  // âœ… ç›´æ¥æ³¨å…¥
        return args -> {
            var chatClient = chatClientBuilder
                .defaultSystem("You are useful assistant...")
                .defaultToolCallbacks(new SyncMcpToolCallbackProvider(mcpSyncClients))  // âœ… æ‰‹å‹•å‰µå»º
                .defaultAdvisors(...)
                .build();

            // ... èŠå¤©é‚è¼¯
        };
    }
}
```

### 2. Starter Default Client (Spring AI 1.1.0-SNAPSHOT)
**è·¯å¾‘**: `model-context-protocol/client-starter/starter-default-client`

#### é—œéµå·®ç•°
```java
import org.springframework.ai.tool.ToolCallbackProvider;  // âš ï¸ æ³›å‹æ¥å£ï¼ˆ1.1.0+ï¼‰

@Bean
public CommandLineRunner predefinedQuestions(
        ChatClient.Builder chatClientBuilder,
        ToolCallbackProvider tools,  // âš ï¸ 1.1.0+ è‡ªå‹•æ³¨å…¥
        ConfigurableApplicationContext context) {

    return args -> {
        var chatClient = chatClientBuilder
            .defaultToolCallbacks(tools)  // âš ï¸ ç›´æ¥ä½¿ç”¨
            .build();
    };
}
```

## âœ… æˆ‘å€‘çš„å°ˆæ¡ˆæ‡‰æ¡ç”¨çš„æ¨¡å¼

### åŸºæ–¼ Spring AI 1.0.3ï¼ˆæ¥è¿‘ 1.0.1ï¼‰

**1. æ­£ç¢ºçš„ Import**
```java
// MCP Java SDKï¼ˆæ ¸å¿ƒå”è­°å¯¦ç¾ï¼‰
import io.modelcontextprotocol.client.McpSyncClient;
import io.modelcontextprotocol.spec.McpSchema;

// Spring AI MCP æ•´åˆ
import org.springframework.ai.mcp.SyncMcpToolCallbackProvider;
```

**2. ChatClientConfig æ­£ç¢ºå¯«æ³•**
```java
@Configuration
@RequiredArgsConstructor
public class ChatClientConfig {

    private final List<McpSyncClient> mcpSyncClients;  // âœ… æ³¨å…¥ Client åˆ—è¡¨

    @Bean
    public ChatClient chatClient(ChatClient.Builder builder) {
        return builder
            .defaultToolCallbacks(new SyncMcpToolCallbackProvider(mcpSyncClients))  // âœ… æ‰‹å‹•å‰µå»º
            .build();
    }
}
```

**3. McpClientService æ­£ç¢ºå¯«æ³•**
```java
@Service
@RequiredArgsConstructor
public class McpClientService {

    private final List<McpSyncClient> mcpSyncClients;  // âœ… æ³¨å…¥ Client åˆ—è¡¨

    public List<ServerInfoResponse> getAllServers() {
        return mcpSyncClients.stream()
            .map(this::buildServerInfo)
            .toList();
    }

    private ServerInfoResponse buildServerInfo(McpSyncClient client) {
        // ä½¿ç”¨ MCP Java SDK çš„ API
        var serverInfo = client.serverInfo();  // âœ…
        var capabilities = client.serverCapabilities();  // âœ…
        // ...
    }
}
```

## ğŸ“Š ç‰ˆæœ¬å°ç…§è¡¨

| ç‰ˆæœ¬ | ToolCallbackProvider ç”¨æ³• | ç¯„ä¾‹ |
|------|---------------------------|------|
| **1.0.1** | æ‰‹å‹•å‰µå»º `new SyncMcpToolCallbackProvider(clients)` | brave-chatbot âœ… |
| **1.0.3** | åŒ 1.0.1ï¼ˆæˆ‘å€‘çš„ç›®æ¨™ç‰ˆæœ¬ï¼‰ | - |
| **1.1.0-SNAPSHOT** | è‡ªå‹•æ³¨å…¥ `ToolCallbackProvider` | starter-default-client |

## ğŸ”§ éœ€è¦ä¿®æ­£çš„é …ç›®

### âœ… å·²å®Œæˆ
1. âœ… ä¿®æ­£æ‰€æœ‰ import èªå¥ï¼ˆä½¿ç”¨ `io.modelcontextprotocol.*`ï¼‰
2. âœ… ä¿®æ­£ ChatClientConfigï¼ˆä½¿ç”¨æ‰‹å‹•å‰µå»ºæ¨¡å¼ï¼‰

### â³ å¾…å®Œæˆ
1. â³ DTO é¡æ·»åŠ  `@Data` æˆ– `@Builder` è¨»è§£
2. â³ ä¿®æ­£ McpClientService ä¸­çš„ API èª¿ç”¨ï¼ˆæ ¹æ“š MCP Java SDK 0.10.0 APIï¼‰
3. â³ ä¿®æ­£æ‰€æœ‰ `log` è®Šæ•¸æœªå®šç¾©å•é¡Œï¼ˆæ·»åŠ  `@Slf4j`ï¼‰
4. â³ è§£æ±º DTO é¡ setter/getter æ–¹æ³•ç¼ºå¤±

## ğŸ¯ MCP Java SDK 0.10.0 API

å¾å®˜æ–¹ç¯„ä¾‹å¯çŸ¥ï¼Œæ­£ç¢ºçš„ API èª¿ç”¨ï¼š

```java
McpSyncClient client = ...;

// ç²å– Server è³‡è¨Š
var serverInfo = client.serverInfo();  // è¿”å› McpSchema.ServerInfo

// ç²å–èƒ½åŠ›
var capabilities = client.serverCapabilities();  // è¿”å› McpSchema.ServerCapabilities

// åˆ—å‡ºå·¥å…·
var toolsResult = client.listTools();  // è¿”å› McpSchema.ListToolsResult

// èª¿ç”¨å·¥å…·
var callResult = client.callTool(toolName, arguments);  // è¿”å› McpSchema.CallToolResult

// åˆ—å‡ºè³‡æº
var resourcesResult = client.listResources();  // è¿”å› McpSchema.ListResourcesResult

// è®€å–è³‡æº
var readResult = client.readResource(uri);  // è¿”å› McpSchema.ReadResourceResult
```

## ğŸ“ é…ç½®æ–‡ä»¶

### application.yml
```yaml
spring:
  ai:
    openai:
      api-key: ${OPENAI_API_KEY}
    mcp:
      client:
        enabled: true
        type: SYNC  # ä½¿ç”¨åŒæ­¥å®¢æˆ¶ç«¯
        toolcallback:
          enabled: false  # âš ï¸ 1.0.x ä¸è‡ªå‹•å‰µå»ºï¼Œæ‰‹å‹•ç®¡ç†
        stdio:
          servers-configuration: classpath:mcp-servers.json
```

### mcp-servers.json (Claude Desktop æ ¼å¼)
```json
{
  "mcpServers": {
    "brave-search": {
      "command": "npx",
      "args": [
        "-y",
        "@modelcontextprotocol/server-brave-search"
      ],
      "env": {
        "BRAVE_API_KEY": "${BRAVE_API_KEY}"
      }
    }
  }
}
```

## ğŸš€ å¾ŒçºŒæ­¥é©Ÿ

1. âœ… æ ¹æ“šå®˜æ–¹ç¯„ä¾‹ä¿®æ­£ ChatClientConfig
2. â³ æŸ¥çœ‹ MCP Java SDK 0.10.0 çš„ JavaDoc æˆ–åŸå§‹ç¢¼
3. â³ ä¿®æ­£æ‰€æœ‰ Service é¡ä¸­çš„ API èª¿ç”¨
4. â³ æ·»åŠ ç¼ºå¤±çš„ Lombok è¨»è§£
5. â³ é‡æ–°ç·¨è­¯ä¸¦æ¸¬è©¦

## ğŸ“š åƒè€ƒè³‡æº

- **Spring AI Examples**: https://github.com/spring-projects/spring-ai-examples
- **MCP Java SDK**: https://github.com/modelcontextprotocol/java-sdk
- **Spring AI æ–‡æª”**: https://docs.spring.io/spring-ai/reference/
- **MCP è¦ç¯„**: https://spec.modelcontextprotocol.io/
